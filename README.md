<a id="readme-top"></a>
[![GPLv3 License](https://img.shields.io/badge/License-GPL%20v3-yellow.svg)](https://opensource.org/licenses/)

# TMF | Mobile App Back End Services

This project contains configuration of back end services used by the [Theodore Madison Foundation's][tmf-url] mobile application.

<!-- TABLE OF CONTENTS -->
<details>
  <summary>Table of Contents</summary>
  <ol>
    <li>
      <a href="#about-the-project">About The Project</a>
      <ul>
        <li><a href="#architecture-diagram">Architecture Diagram</a></li>
        <li><a href="#built-with">Built With</a></li>
      </ul>
    </li>
    <li>
      <a href="#getting-started">Getting Started</a>
      <ul>
        <li><a href="#prerequisites">Prerequisites</a></li>
        <li><a href="#deploying-to-aws">Deploying to AWS</a></li>
        <li><a href="#testing-with-postman">Testing with Postman</a></li>
        <li><a href="#testing-within-the-appsync-console">Testing within the AppSync Console</a></li>
      </ul>
    </li>
  </ol>
</details>

<!-- ABOUT THE PROJECT -->
## About The Project

### Architecture Diagram

![architecture-diagram-url]

1. User sign up, authentication, and token refresh takes place directly between the mobile application and AWS Cognito.
2. Upon new user sign up, Cognito sends an account verification email to the user.
3. Users with verified email addresses must create a profile. User profile data is saved to a DynamoDB record, and their profile image is saved to S3.
4. Application functionality through the mobile client is conducted through GraphQL requests where the server is hosted on AppSync.

### Built With

* [![graphql]][graphql-url]

<p align="right">(<a href="#readme-top">back to top</a>)</p>

<!-- GETTING STARTED -->
## Getting Started

### Prerequisites

An [AWS account][aws-new-account-url] is required in order to run the necessary services for this application.

**WARNING:** This project provisions AWS resources which may incur costs. Please ensure you review the [AWS pricing][aws-pricing-url] for the services used and monitor your account to avoid unexpected charges.

1. Install the [SAM CLI][sam-cli-url] 
2. Clone the project
```bash
  git clone https://github.com/chanson7/TMF-App.git
```

### Deploying AWS Services
1. Validate the SAM Template
```bash
  sam validate --lint
```
2. Build the project
```bash
  sam build
```
3. Deploy the project *(use --guided for the initial deployment)*
```bash
  sam deploy --guided
```

### Testing with Postman

1. After successful deployment, import the [Postman Collection][postman-collection-url] json file into Postman
2. Within the imported `TMF App` collection, populate values for the following environment variables:
* `testUserEmail` any email address that you have access to
* `testUserPassword` any password that fits the requirements defined in the [SAM Template][sam-template-url]
* `awsRegion` must be the region in which the SAM app was deployed
* `mobileAppClientId` the [MobileAppClient ID][aws-app-clients-url] is generated by AWS after a successful SAM deployment
* `userPoolId` the [User Pool ID][aws-user-pool-url] is generated by AWS after a successful SAM deployment. It can be found in Cognito within the AWS Console
3. Test individual calls within Postman

### Testing within the AppSync Console

<p align="right">(<a href="#readme-top">back to top</a>)</p>

<!-- MARKDOWN LINKS & IMAGES -->
[aws-new-account-url]: https://aws.amazon.com/free/
[aws-pricing-url]: https://aws.amazon.com/pricing/
[aws-app-clients-url]: https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-client-apps.html
[aws-user-pool-url]: https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools.html
[graphql]: https://img.shields.io/badge/GraphQl-E10098?style=for-the-badge&logo=graphql&logoColor=white
[graphql-url]: https://graphql.org/
[sam-cli-url]: https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/install-sam-cli.html
[tmf-url]: https://theodoremadisonfoundation.org/

[postman-collection-url]: https://github.com/chanson7/TMF-App/blob/main/TMF_App.postman_collection.json
[sam-template-url]: https://github.com/chanson7/TMF-App/blob/main/template.yaml
[architecture-diagram-url]: https://github.com/chanson7/TMF-App/blob/main/TMF_App_Architecture.drawio.svg